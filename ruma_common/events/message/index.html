<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Types for extensible text message events (MSC1767)."><meta name="keywords" content="rust, rustlang, rust-lang, message"><title>ruma_common::events::message - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><script defer src="../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="icon" href="https://www.ruma.io/favicon.ico"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../../ruma_common/index.html"><div class="logo-container"><img src="https://www.ruma.io/images/logo.png" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../../ruma_common/index.html"><div class="logo-container">
                    <img src="https://www.ruma.io/images/logo.png" alt="logo"></div>
        </a><h2 class="location"><a href="#">Module message</a></h2><div class="sidebar-elems"><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#types">Type Definitions</a></li></ul></div></section><div id="sidebar-vars" data-name="message" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../../ruma_common/index.html">
                        <img src="https://www.ruma.io/images/logo.png" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><div id="settings-menu" tabindex="-1">
                                <a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Module <a href="../../index.html">ruma_common</a>::<wbr><a href="../index.html">events</a>::<wbr><a class="mod" href="#">message</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../../../src/ruma_common/events/message.rs.html#1-284">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><span class="item-info"><div class="stab portability">Available on <strong>crate features <code>events</code> and <code>unstable-msc1767</code></strong> only.</div></span><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Types for extensible text message events (<a href="https://github.com/matrix-org/matrix-spec-proposals/pull/1767">MSC1767</a>).</p>
<h2 id="extensible-events"><a href="#extensible-events">Extensible events</a></h2>
<p>MSCs <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/1767">1767</a> (Text, Emote and Notice), <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3551">3551</a> (Files), <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3552">3552</a> (Images and Stickers), <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3553">3553</a>
(Videos), <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3246">3246</a> (Audio), and <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3488">3488</a> (Location) introduce new primary types called extensible
events. These types are meant to replace the <code>m.room.message</code> primary type and its <code>msgtype</code>s.
Other MSCs introduce new types with an <code>m.room.message</code> fallback, like <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3245">MSC3245</a> (Voice
Messages), and types that only have an extensible events format, like <a href="https://github.com/matrix-org/matrix-spec-proposals/pull/3381">MSC3381</a> (Polls).</p>
<h2 id="transition-period"><a href="#transition-period">Transition Period</a></h2>
<p>MSC1767 defines a transition period that will start after the extensible events are released in
a Matrix version. It should last approximately one year, but the end of that period will be
formalized in a new Matrix version.</p>
<p>The new primary types should not be sent over the Matrix network before the end of the
transition period. Instead, transitional <code>m.room.message</code> events should be sent. These
transitional events include the content of the now legacy <code>m.room.message</code> event and the content
of the new extensible event types in a single event.</p>
<h2 id="how-to-use-them"><a href="#how-to-use-them">How to use them</a></h2>
<p>First, you can enable the <code>unstable-extensible-events</code> feature from the <code>ruma</code> crate, that
will enable all the MSCs for the extensible events that correspond to the legacy <code>msgtype</code>s
(1767, 3246, 3488, 3551, 3552, 3553). It is also possible to enable only the MSCs you want with
the <code>unstable-mscXXXX</code> features (where <code>XXXX</code> is the number of the MSC).</p>
<p>The recommended way to send transitional extensible events while they are unstable and during
the transition period is to build one of the new primary types and then to convert it to a
<a href="../room/message/struct.RoomMessageEventContent.html"><code>RoomMessageEventContent</code></a> by using <code>.into()</code> or <code>RoomMessageEventContent::from()</code>. The
provided constructors will copy the relevant data in the legacy fields.</p>
<p>For incoming events, a <code>RoomMessageEventContent</code> can be converted to an extensible event with
the relevant <code>from_*_room_message</code> method on the primary type. This conversion will work even
with legacy <code>m.room.message</code> events that don’t have extensible events content.</p>
<p>It is also possible to enable extensible events support and continue using
<code>RoomMessageEventContent</code>’s constructors. The data will be duplicated in both the legacy and
extensible events fields.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.EmptyMessageContentError.html" title="ruma_common::events::message::EmptyMessageContentError struct">EmptyMessageContentError</a></div><div class="item-right docblock-short"><p>The error type returned when trying to construct an empty <code>MessageContent</code>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MessageContent.html" title="ruma_common::events::message::MessageContent struct">MessageContent</a></div><div class="item-right docblock-short"><p>Text message content.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.MessageEventContent.html" title="ruma_common::events::message::MessageEventContent struct">MessageEventContent</a></div><div class="item-right docblock-short"><p>The payload for an extensible text message.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.RedactedMessageEventContent.html" title="ruma_common::events::message::RedactedMessageEventContent struct">RedactedMessageEventContent</a></div><div class="item-right docblock-short"><p>Redacted form of <a href="struct.MessageEventContent.html" title="MessageEventContent"><code>MessageEventContent</code></a></p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Text.html" title="ruma_common::events::message::Text struct">Text</a></div><div class="item-right docblock-short"><p>Text message content.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TryFromExtensibleError.html" title="ruma_common::events::message::TryFromExtensibleError enum">TryFromExtensibleError</a></div><div class="item-right docblock-short"><p>The error type returned when a conversion to an extensible event type fails.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.MessageEvent.html" title="ruma_common::events::message::MessageEvent type">MessageEvent</a></div><div class="item-right docblock-short"><p>An <code>m.message</code> event.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.OriginalMessageEvent.html" title="ruma_common::events::message::OriginalMessageEvent type">OriginalMessageEvent</a></div><div class="item-right docblock-short"><p>An <code>m.message</code> event.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.OriginalSyncMessageEvent.html" title="ruma_common::events::message::OriginalSyncMessageEvent type">OriginalSyncMessageEvent</a></div><div class="item-right docblock-short"><p>An <code>m.message</code> event from a <code>sync_events</code> response.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.RedactedMessageEvent.html" title="ruma_common::events::message::RedactedMessageEvent type">RedactedMessageEvent</a></div><div class="item-right docblock-short"><p>An <code>m.message</code> event that has been redacted.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.RedactedSyncMessageEvent.html" title="ruma_common::events::message::RedactedSyncMessageEvent type">RedactedSyncMessageEvent</a></div><div class="item-right docblock-short"><p>An <code>m.message</code> event from a <code>sync_events</code> response that has been redacted.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="type" href="type.SyncMessageEvent.html" title="ruma_common::events::message::SyncMessageEvent type">SyncMessageEvent</a></div><div class="item-right docblock-short"><p>An <code>m.message</code> event from a <code>sync_events</code> response.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="ruma_common" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.63.0-nightly (490324f7b 2022-05-26)" ></div>
</body></html>